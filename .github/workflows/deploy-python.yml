name: Deploy Python (Coolify)

on:
  push:
    branches: ["main"]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Coolify deploy (Python)
        run: |
          set -e
          echo "Triggering Coolify deploy..."
          code=$(curl -sS -o /tmp/resp.txt -w "%{http_code}" -X POST \
            -H "Authorization: Bearer ${{ secrets.COOLIFY_TOKEN }}" \
            "https://ai.hack.bluerack.org/api/v1/deploy?uuid=ds0ccokkkowko8gksso88s8o&force=false")
          echo "HTTP $code"
          echo "--- response ---"
          cat /tmp/resp.txt
          echo "---------------"
          if [ "$code" -lt 200 ] || [ "$code" -ge 300 ]; then exit 1; fi
